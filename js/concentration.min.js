"use strict";(()=>{const TIMING={FLIP_CHECK_DELAY:1250,MISMATCH_GROW_DELAY:800,MATCH_ROTATE_DELAY:50,MATCH_REMOVE_DELAY:475,WIN_MODAL_DELAY:700,WIN_MODAL_DURATION:1000,FINAL_MODAL_DURATION:3000,DISCO_INTERVAL:400,CARD_DEAL_INTERVAL:57,DEAL_START_DELAY:150,DEAL_MODAL_EXTRA:275};const GAME={CARD_COUNT:40,MATCHES:20,MIN_VALID_SCORE:20,COOKIE_EXPIRY_DAYS:7};let flippedCards=0;let matchedCards=0;let canFlip=true;let gameStarted=false;let gameOver=false;let flipsCheckedCount=0;let discoMode=false;let lastColor="";const createList=()=>{const rv=[];for(let i=1;i<=GAME.MATCHES;i++){rv[i]="cat"+i+".png"}return rv};const imageStore=createList();const shuffle=(a)=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};const assignment=()=>{const arr1=[];for(let i=0;i<GAME.MATCHES;i++){arr1.push(i+1);arr1.push(i+1)}return shuffle(arr1)};const matchList=assignment();const checkForMatch=()=>{const cardsToCheck=document.querySelectorAll(".flip-card-flip");flipsCheckedCount++;if(matchList[cardsToCheck[0].id]===matchList[cardsToCheck[1].id]){sleep(TIMING.MATCH_ROTATE_DELAY).then(()=>{Array.from(cardsToCheck[0].childNodes).find((elem)=>elem.classList.contains("flip-card-back")).firstChild.classList.add("match-rotate");Array.from(cardsToCheck[1].childNodes).find((elem)=>elem.classList.contains("flip-card-back")).firstChild.classList.add("match-rotate");Array.from(cardsToCheck[0].childNodes).find((elem)=>elem.classList.contains("flip-card-front")).classList.remove("box-shadow");Array.from(cardsToCheck[1].childNodes).find((elem)=>elem.classList.contains("flip-card-front")).classList.remove("box-shadow")});sleep(TIMING.MATCH_REMOVE_DELAY).then(()=>{cardsToCheck[0].remove();cardsToCheck[1].remove()});if(++matchedCards===GAME.MATCHES){let newbestScore=bestScoreOnLoad<GAME.MIN_VALID_SCORE?flipsCheckedCount:flipsCheckedCount<bestScoreOnLoad?flipsCheckedCount:bestScoreOnLoad;gameOver=true;sleep(TIMING.WIN_MODAL_DELAY).then(()=>{modal("Kaiya and Pepper!",TIMING.WIN_MODAL_DURATION);sleep(TIMING.WIN_MODAL_DURATION).then(()=>{sleep(TIMING.FINAL_MODAL_DURATION).then(()=>location.reload());modal("Best Score: "+newbestScore,TIMING.FINAL_MODAL_DURATION)})});setCookie("concbestScore",newbestScore,GAME.COOKIE_EXPIRY_DAYS)}}else{cardsToCheck[0].classList.remove("flip-card-flip");cardsToCheck[1].classList.remove("flip-card-flip");sleep(TIMING.MISMATCH_GROW_DELAY).then(()=>{cardsToCheck[0].classList.add("grow");cardsToCheck[1].classList.add("grow")})}canFlip=true;flippedCards=0};const colorSelectHandler=()=>{const select=document.getElementById("color-select");const colorTo=select.options[select.selectedIndex].value;const cards=document.querySelectorAll(".flip-card-front");if(colorTo==="disco"){discoMode=true;disco(cards)}else{discoMode=false;clearCardBackClasses(cards);addCardBackClass(cards,colorTo)}};const clearCardBackClasses=(cards)=>{for(let card of cards){card.classList.remove("grey-pattern");card.classList.remove("blue-pattern");card.classList.remove("purple-pattern");card.classList.remove("orange-pattern")}};const addCardBackClass=(cards,colorTo)=>{for(let card of cards){card.classList.add(colorTo+"-pattern")}};function modal(message,duration){const modalBox=document.createElement("div");modalBox.id="modal-box";const innerModalBox=document.createElement("div");innerModalBox.id="inner-modal-box";const modalMessage=document.createElement("span");modalMessage.id="modal-message";innerModalBox.appendChild(modalMessage);modalBox.appendChild(innerModalBox);modalMessage.innerText=message;document.getElementsByTagName("html")[0].appendChild(modalBox);sleep(duration).then(()=>modalBox.remove())}function randomIntFromInterval(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function sleep(ms){return new Promise((resolve)=>setTimeout(resolve,ms))}const disco=(cards)=>{if(discoMode){clearCardBackClasses(cards);const colors=["grey","blue","purple","orange"];let colorTo;do{colorTo=colors[randomIntFromInterval(0,3)]}while(colorTo===lastColor);lastColor=colorTo;addCardBackClass(cards,colorTo);sleep(TIMING.DISCO_INTERVAL).then(()=>disco(cards))}};function setCookie(cname,cvalue,exdays){var d=new Date();d.setTime(d.getTime()+exdays*24*60*60*1000);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/;SameSite=Lax"}function getCookie(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1)}if(c.indexOf(name)===0){return c.substring(name.length,c.length)}}return""}const bestScore=document.getElementById("bestScore");const bestScoreOnLoad=Number(getCookie("concbestScore"));const dealCards=()=>{let rows;let cols;if(window.matchMedia("(min-width: 801px)").matches){rows=5;cols=8}else{rows=10;cols=4}for(let i=0;i<rows;i++){const row=document.createElement("div");document.getElementById("cards").appendChild(row);row.classList.add("row");row.draggable=false;row.ondragstart=function(){return false};row.onmousedown=function(){return false};for(let j=0;j<cols;j++){const flipCard=document.createElement("div");const flipCardInner=document.createElement("div");const flipCardFront=document.createElement("div");const flipCardBack=document.createElement("div");const image=document.createElement("img");flipCard.classList.add("flip-card");flipCardInner.classList.add("flip-card-inner");flipCardFront.classList.add("flip-card-front");flipCardFront.classList.add("box-shadow");flipCardBack.classList.add("flip-card-back");flipCard.appendChild(flipCardInner);flipCardInner.appendChild(flipCardFront);flipCardInner.appendChild(flipCardBack);flipCardInner.classList.add("hidden");row.appendChild(flipCard);flipCardInner.id=i*cols+j;image.src="images/"+imageStore[matchList[i*cols+j]];image.classList.add("cat-image");flipCardBack.appendChild(image);const handleCardFlip=()=>{if(canFlip&&gameStarted&&!gameOver){if(flipCardInner.classList.contains("flip-card-flip")){flipCardInner.classList.remove("flip-card-flip");flipCardInner.classList.add("grow");flippedCards--}else{if(flippedCards===0||flippedCards===1){flipCardInner.classList.add("flip-card-flip");flipCardInner.classList.remove("grow");flippedCards++;if(flippedCards===2){canFlip=false;sleep(TIMING.FLIP_CHECK_DELAY).then(checkForMatch)}}}}};flipCardInner.addEventListener("click",handleCardFlip);flipCardInner.setAttribute("tabindex","0");flipCardInner.setAttribute("role","button");flipCardInner.setAttribute("aria-label","Card "+(i*cols+j+1));flipCardInner.addEventListener("keydown",(e)=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();handleCardFlip()}})}}colorSelectHandler();const cards=document.querySelectorAll(".flip-card-inner");const len=cards.length;for(let i=0;i<len;i++){setTimeout(()=>cards[i].classList.remove("hidden"),i*TIMING.CARD_DEAL_INTERVAL);cards[i].classList.add("grow");cards[i].classList.add("hover-cursor")}};(()=>{document.getElementById("startBtn").addEventListener("click",()=>{if(!gameStarted){gameStarted=true;document.getElementById("startBtn").classList.remove("startButtonFlash");document.getElementById("main-header").classList.remove("header-before-start");document.getElementById("main-header").classList.add("header-after-start");document.getElementById("menu").classList.remove("menu-before-start");document.getElementById("menu").classList.add("menu-after-start");document.getElementById("menu").classList.add("display-flex");document.getElementById("bestScoreContainer").remove();modal("Dealing Cards!",GAME.CARD_COUNT*TIMING.CARD_DEAL_INTERVAL+TIMING.DEAL_MODAL_EXTRA);sleep(TIMING.DEAL_START_DELAY).then(()=>{dealCards()})}});document.getElementById("color-select").addEventListener("change",colorSelectHandler);bestScore.textContent=bestScoreOnLoad<GAME.MIN_VALID_SCORE?"No Best Score":bestScoreOnLoad+" Pairs Flipped"})()})();
